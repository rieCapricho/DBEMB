<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="assets/images/logo2.PNG">
    <title>Davao Blue Eagle Scout - Cirva A La Gente Por La Musica</title>
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,800,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/plugins/font-awesome/css/all.min.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/custom.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }
        .status-active { color: #28a745; }
        .status-inactive { color: #dc3545; }
    </style>
    <script type="text/javascript">
        if (!localStorage.getItem("user")) {
            window.location.href = "login";
        }    

        document.addEventListener("DOMContentLoaded", function() {
            const currentUrl = window.location.href;
            const links = document.querySelectorAll('.accordion-menu a');

            links.forEach(link => {
                if (currentUrl.includes(link.getAttribute('href'))) {
                    link.classList.add('active');
                }
            });
        });
    </script>
    
</head>
<body>
    <div style="position: fixed;top: 0px;left: 0px;width: 100%;background: #F4F7FC;z-index: 9999;padding: 0px;">
<div class="lime-sidebar">
    <div class="lime-sidebar-inner slimscroll">
      <ul class="accordion-menu">
        <li class="sidebar-title">Navigations</li>
        <li><a href="dashboard"><i class="material-icons">dashboard</i><span>Dashboard</span></a></li>
        <li><a href="events"><i class="material-icons">event</i><span>Events</span></a></li>
        <li><a href="revenues"><i class="material-icons">trending_up</i><span>Revenues</span></a></li>
        <li><a href="payments"><i class="material-icons">payment</i><span>Payments</span></a></li>
        <li><a href="expenses"><i class="material-icons">request_quote</i><span>Expenses</span></a></li>
        <li><a href="officers"><i class="material-icons">people</i><span>Officers</span></a></li>
        <li><a href="login_history"><i class="material-icons">schedule</i><span>Login History</span></a></li>
        <li><a href="summary"><i class="material-icons">bar_chart</i>Summary</a></li>

        <li><a href="members"><i class="material-icons">people</i><span>Members</span></a></li>
      </ul>
      <ul class="accordion-menu" id="Othersnav">
        <li class="divider"></li>
        <li class="sidebar-title">Others</li>
        <li><a onclick="localStorage.removeItem('user'); window.location.href = 'login';"><i class="material-icons">power_settings_new</i><span>Logout</span></a></li>
      </ul>
    </div>
  </div>

<style>
@media (max-width: 1024px) {
  #Othersnav {
    display: block;
  }
}
@media (min-width: 1025px) {
  #Othersnav {
    display: none;
  }
}
</style>

<div class="lime-header" style="padding: 0px;">
<nav class="navbar navbar-expand-lg">
  <section class="material-design-hamburger navigation-toggle">
    <a href="javascript:void(0)" class="button-collapse material-design-hamburger__icon">
      <span class="material-design-hamburger__layer"></span>
    </a>
  </section>
  <a class="navbar-brand" href="">
    <img src="assets/images/logo2.png" style="height: 75px;width: 75px;">
  </a>
  <button class="navbar-toggler" type="button"  style="margin-right: 10px" onclick="localStorage.removeItem('user'); window.location.href = 'login';">
    <i class="material-icons" style="font-size: 20px;">power_settings_new</i>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav ml-auto">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="material-icons">more_vert</i>
        </a>
        <ul class="dropdown-menu dropdown-menu-right">
          <li><a class="dropdown-item" onclick="localStorage.removeItem('user'); window.location.href = 'index.html';">Logout</a></li>
        </ul>
      </li>
    </ul>
  </div>
</nav>
</div>
</div>

        <div class="lime-container">
            <div class="lime-body" style="margin-top:100px">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title" style="text-align: center;">(<span style="color:#07102F" id="TotalRows"></span>) Officers record</h5>
    
                                    <div class="row">
                                        <div class="col-12 col-md-12">
                                            <div class="todo-sidebar">
                                                <div class="row">
                                                    <div class="col-12 col-md-6 mb-3">
                                                        <div class="todo-new-task">
                                                            <button class="btn btn-primary btn-block" style="height:42px;" data-toggle="modal" data-target="#newMemberModal">Create New Officer</button>
                                                        </div>
                                                    </div>
                                                    <div class="col-12 col-md-6 mb-3">
                                                        <div class="todo-search m-b-lg">
                                                            <div class="input-group">
                                                                <input type="text" id="search" class="form-control" placeholder="Search Officers">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-12">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="card stat-card">
                                                        <div class="card-body bg-info">
                                                            <h5 class="card-title">Total Active Officers</h5>
                                                            <h2 class="float-right" id="TotalActive" style="color:white;"></h2>
                                                            <p style="color:white;font-weight: bold;">Officer</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="card stat-card">
                                                        <div class="card-body bg-warning">
                                                            <h5 class="card-title">Total Inactive Officers</h5>
                                                            <h2 class="float-right" id="TotalInactive" style="color:white;"></h2>
                                                            <p style="color:white;font-weight: bold;">Officer</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card">
                                                <div class="card-body" style="padding: 0px;">
                                                    <div class="table-responsive">
                                                        <table class="table" id="membersTable">
                                                            <thead>
                                                                <tr>
                                                                    <th>Fullname</th>
        <th>Role</th>
         <th>Phone Number</th>
        <th>Status</th>
        <th>Username</th>
        <th>Actions</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="memberTableBody"></tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lime-footer">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <span class="footer-text">2025 Â© Davao Blue Eagle Scout</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Member Modal -->
        <div class="modal fade" id="newMemberModal" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="z-index: 99999999;background: rgba(0, 0, 0, 0.5);">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Create New Officer</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <i class="material-icons">close</i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="signupForm">
        <div class="form-group">
            <input type="text" class="form-control" id="firstName" required placeholder="First Name">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" id="lastName" required placeholder="Last Name">
        </div>
        <div class="form-group">
            <input type="number" class="form-control" id="contactNumber" required placeholder="Contact Number">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" id="position" required placeholder="Position">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" id="userName" required placeholder="Username">
        </div>
        <div class="form-group">
            <input type="password" class="form-control" id="password" required placeholder="Password">
        </div>
        <br>
       <div class="modal-footer" style="padding-right: 0px;">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add New Officer</button>
                    </div>

        
    </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Member Modal -->
        <div class="modal fade" id="editMemberModal" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="z-index: 99999999;background: rgba(0, 0, 0, 0.5);">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Edit Officer</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <i class="material-icons">close</i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="edit_signupForm">

                        <input id="edit_personID" type="hidden" />
                        
    <div class="form-group">
        <input type="text" class="form-control" id="edit_firstName" required placeholder="First Name">
    </div>
    <div class="form-group">
        <input type="text" class="form-control" id="edit_lastName" required placeholder="Last Name">
    </div>
    <div class="form-group">
        <input type="number" class="form-control" id="edit_contactNumber" required placeholder="Contact Number">
    </div>
    <div class="form-group">
        <input type="text" class="form-control" id="edit_position" required placeholder="Position">
    </div>

    <div class="form-group">
        <select id="edit_status" class="form-control">
    <option value="Active">Active</option>
    <option value="Inactive">Inactive</option>
</select>

    </div>

    <div class="form-group">
        <input type="text" class="form-control" id="edit_userName" required placeholder="Username">
    </div>
    <div class="form-group">
        <input type="password" class="form-control" id="new_password" placeholder="New Password">
    </div>
    <br>
    <div class="modal-footer" style="padding-right: 0px;">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Changes</button>
    </div>
</form>

                    </div>
                </div>
            </div>
        </div>

       <!-- Password Confirmation Modal -->
<div class="modal fade" id="passwordConfirmModal" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="z-index: 99999999;background: rgba(0, 0, 0, 0.5);">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Deletion</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>
  Are you sure you want to delete this officer? <br>
  
  <em>All related data including revenues, expenses, payments, and records will also be deleted.</em>
</p>

                <div class="form-group">
                    <label for="deletePassword">To confirm, type your password below</label>
                    <input type="password" class="form-control" id="deletePassword" placeholder="Password">
                    <br>
                    <strong style="color:#FC6060">This action cannot be undone.</strong><br>
                </div>
                <div id="passwordError" class="text-danger" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="dummy_confirmDeleteBtn" disabled style="margin-right: -8px;">Delete</button>
                <form id="deleteForm">
                 <input type="hidden" id="idtodelete" name="idtodelete">
                <button type="submit" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </form>

                <script>

                     $(document).ready(function () {
    $('#deleteForm').on('submit', function (e) {
      e.preventDefault();

      const idToDelete = $('#idtodelete').val();

      if (!idToDelete) {
        alert('Please enter a valid ID.');
        return;
      }

      $.ajax({
        url: `/deletemember/${idToDelete}`,
        type: 'DELETE',
        success: function (response) {
          alert("Deleted successfully!");
          window.location.reload();
        },
        error: function (xhr) {
          const error = xhr.responseJSON?.error || xhr.responseJSON?.message || 'An error occurred.';
          alert('Error: ' + error);
        }
      });
    });
  });


    setInterval(function () {
        const deletePassword = document.getElementById('deletePassword')?.value;
        const storedId = localStorage.getItem('logged_uniqueid');

        if (deletePassword === storedId) {
            document.getElementById('confirmDeleteBtn').style.display = 'block';
            document.getElementById('dummy_confirmDeleteBtn').style.display = 'none';
        } else {
            document.getElementById('confirmDeleteBtn').style.display = 'none';
            document.getElementById('dummy_confirmDeleteBtn').style.display = 'block';
        }
    }, 100); 
</script>

            </div>
        </div>
    </div>
</div>

        <!-- Javascripts -->
        <script src="assets/plugins/jquery/jquery-3.1.0.min.js"></script>
        <script src="assets/plugins/bootstrap/popper.min.js"></script>
        <script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js"></script>
        <script src="assets/js/lime.min.js"></script>
        
       <script>

       



        $(document).ready(function () {
    $("#signupForm").submit(function (e) {
        e.preventDefault();

        let formData = {
            firstName: $("#firstName").val(),
            lastName: $("#lastName").val(),
            contactNumber: $("#contactNumber").val(),
            position: $("#position").val(),
            userName: $("#userName").val(),
            password: $("#password").val(),
        };


        $.ajax({
            url: "/process_register",
            type: "POST",
            data: JSON.stringify(formData),
            contentType: "application/json",
            success: function (response) {
                if(response.success === 'Username already exists!'){

                    alert(response.success);
                    $("#userName").val("");
                } else {
                    alert(response.success);
                    window.location.reload();
                    
                }

            },
            error: function (xhr) {
                console.error("AJAX Error:", xhr.responseText);
                alert("Error: " + xhr.responseText);
            }
        });
    });
});










 $(document).ready(function () {
    $("#edit_signupForm").submit(function (e) {
        e.preventDefault();

    let formData = {
    personID: $("#edit_personID").val(),
    firstName: $("#edit_firstName").val(),
    lastName: $("#edit_lastName").val(),
    contactNumber: $("#edit_contactNumber").val(),
    position: $("#edit_position").val(),
    userName: $("#edit_userName").val(),
    NewStatus: $("#edit_status").val(),
    password: $("#new_password").val()
};


        $.ajax({
            url: "/update_member",
            type: "POST",
            data: JSON.stringify(formData),
            contentType: "application/json",
            success: function (response) {
        if (response.success === 'Username already exists!') {
            alert(response.success);
            $("#edit_userName").val("");
        } else {
            alert(response.success);
            console.log(response.success);
            location.reload(); // Refresh the page
        }
    },
            error: function (xhr) {
                console.error("AJAX Error:", xhr.responseText);
                alert("Error: " + xhr.responseText);
            }
        });
    });
});




        $("#search").on("keyup", function () {
    const searchTerm = $(this).val().toLowerCase();
    
    $("#membersTable tr").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(searchTerm) > -1);
    });
});


  fetch('/getmembers')
    .then(response => response.json())
    .then(data => {
      const tbody = document.querySelector('#membersTable tbody');
      let activeCount = 0;
      let inactiveCount = 0;
      

      data.forEach(member => {
        // Count active/inactive
        if (member.Status.toLowerCase() === 'active') {
          activeCount++;
        } else {
          inactiveCount++;
        }

        // Add row to table
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${member.FullName}</td>
          <td>${member.Role}</td>
          <td>${member.ContactNumber}</td>
          <td>
  <span style="color:white;font-weight:lighter" class="badge ${member.Status === 'Active' ? 'bg-info' : 'bg-danger'}">
    ${member.Status}
  </span>
</td>

          <td>${member.Username}</td>
          <td>
            <button class="btn btn-secondary btn-sm edit-btn" 
      onclick="editMember('${member.PersonID}', '${member.FullName}', '${member.Role}', '${member.ContactNumber}', '${member.Status}', '${member.Username}')">
      Edit
    </button>
            <button  class="btn btn-danger btn-sm delete-btn" onclick="deleteMember(${member.PersonID})">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      // Update <p> elements
      document.getElementById('TotalActive').textContent = `${activeCount}`;
      document.getElementById('TotalInactive').textContent = `${inactiveCount}`;

document.getElementById('TotalRows').textContent = activeCount + inactiveCount;

    });

    
 function editMember(id, fullName, role, contactNumber, status, username) {

     const nameParts = fullName.split(' ');
    const firstName = nameParts[0] || '';
    const lastName = nameParts.slice(1).join(' ') || '';

    // Fill form inputs
    document.getElementById('edit_firstName').value = firstName;
    document.getElementById('edit_lastName').value = lastName;
    document.getElementById('edit_contactNumber').value = contactNumber;
    document.getElementById('edit_position').value = role;
    document.getElementById('edit_userName').value = username;
    document.getElementById('edit_personID').value = id;
    document.getElementById('edit_status').value = status;
    

    // Show the modal
    
    $('#editMemberModal').modal('show');
}


  function deleteMember(id) {
    document.getElementById('idtodelete').value = id;

    $('#passwordConfirmModal').modal('show');
  }
</script>

    </body>
</html>