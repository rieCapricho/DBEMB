<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="assets/images/logo2.PNG">
    <title>Davao Blue Eagle Scout - Cirva A La Gente Por La Musica</title>
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,800,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/plugins/font-awesome/css/all.min.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/custom.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
             select {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    } 

         </style>
    <script type="text/javascript">
    if (!localStorage.getItem("user")) {
        window.location.href = "login";
    }    

    document.addEventListener("DOMContentLoaded", function() {
    const currentUrl = window.location.href;
    const links = document.querySelectorAll('.accordion-menu a');

    links.forEach(link => {
        if (currentUrl.includes(link.getAttribute('href'))) {
            link.classList.add('active');
        }
    });
});


</script>
    
    </head>
    <body>
        <div style="position: fixed;top: 0px;left: 0px;width: 100%;background: #F4F7FC;z-index: 9999;padding: 0px;">
 <div class="lime-sidebar">
    <div class="lime-sidebar-inner slimscroll">
      <ul class="accordion-menu">
        <li class="sidebar-title">Navigations</li>
        <li><a href="dashboard"><i class="material-icons">dashboard</i><span>Dashboard</span></a></li>
        <li><a href="events"><i class="material-icons">event</i><span>Events</span></a></li>
        <li><a href="revenues"><i class="material-icons">trending_up</i><span>Revenues</span></a></li>
        <li><a href="payments"><i class="material-icons">payment</i><span>Payments</span></a></li>
        <li><a href="expenses"><i class="material-icons">request_quote</i><span>Expenses</span></a></li>
        <li><a href="officers"><i class="material-icons">people</i><span>Officers</span></a></li>
        <li><a href="login_history"><i class="material-icons">schedule</i><span>Login History</span></a></li>
        <li><a href="summary"><i class="material-icons">bar_chart</i>Summary</a></li>

        <li><a href="members"><i class="material-icons">people</i><span>Members</span></a></li>
      </ul>
      <ul class="accordion-menu" id="Othersnav">
        <li class="divider"></li>
        <li class="sidebar-title">Others</li>
        <li><a onclick="localStorage.removeItem('user'); window.location.href = 'login';"><i class="material-icons">power_settings_new</i><span>Logout</span></a></li>
      </ul>
    </div>
  </div>

  <style>
    @media (max-width: 1024px) {
      #Othersnav {
        display: block;
      }
    }
    @media (min-width: 1025px) {
      #Othersnav {
        display: none;
      }
    }
  </style>

  <div class="lime-header" style="padding: 0px;">
    <nav class="navbar navbar-expand-lg">
      <section class="material-design-hamburger navigation-toggle">
        <a href="javascript:void(0)" class="button-collapse material-design-hamburger__icon">
          <span class="material-design-hamburger__layer"></span>
        </a>
      </section>
      <a class="navbar-brand" href="">
        <img src="assets/images/logo2.png" style="height: 75px;width: 75px;">
      </a>
      <button class="navbar-toggler" type="button"  style="margin-right: 10px" onclick="localStorage.removeItem('user'); window.location.href = 'login';">
        <i class="material-icons" style="font-size: 20px;">power_settings_new</i>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="material-icons">more_vert</i>
            </a>
            <ul class="dropdown-menu dropdown-menu-right">
              <li><a class="dropdown-item" onclick="localStorage.removeItem('user'); window.location.href = 'index.html';">Logout</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>
  </div>
</div>











        <div class="lime-container">
            <div class="lime-body" style="margin-top:100px">
                <div class="container">


                        
                    <div class="row">

                        <div class="col">

                            <div class="card">
                                <div class="card-body">
                                      <h5 class="card-title" style="text-align: center;">(<span style="color:#07102F" id="TotalRows">0</span>) Login History</h5>
    
                                    <div class="row">


                                        <div class="col-md-12">
                 

<div class="card">
    <div class="card-body" style="padding: 0px;">
        <div class="table-responsive">
           <table class="table" id="paymenttabledata">
      <thead>
        <tr>
          <th>Full Name</th>
          <th>Position</th>
          <th>Login Time</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="paymentTableBody">
        <!-- Rows will be inserted here -->
      </tbody>
    </table>

        </div>
    </div>
</div>








                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="modal fade" id="passwordConfirmModal" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="z-index: 99999999;background: rgba(0, 0, 0, 0.5);">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Deletion</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>
  Are you sure you want to delete this login history? <br>
  
  <em>All related data including revenues, expenses, payments, and records will also be deleted.</em>
</p>

                <div class="form-group">
                    <label for="deletePassword">To confirm, type your password below</label>
                    <input type="password" class="form-control" id="deletePassword" placeholder="Password">
                    <br>
                    <strong style="color:#FC6060">This action cannot be undone.</strong><br>
                </div>
                <div id="passwordError" class="text-danger" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="dummy_confirmDeleteBtn" disabled style="margin-right: -8px;">Delete</button>
                <form id="deleteForm">
                 <input type="hidden" id="idtodelete" name="idtodelete">
                <button type="submit" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </form>

                <script>

                     $(document).ready(function () {
    $('#deleteForm').on('submit', function (e) {
      e.preventDefault();

      const idToDelete = $('#idtodelete').val();

      if (!idToDelete) {
        alert('Please enter a valid ID.');
        return;
      }

    


        
  fetch(`/login-history/${idToDelete}`, {
    method: 'DELETE'
  })
  .then(response => {
    if (!response.ok) throw new Error('Delete failed');
    return response.json();
  })
  .then(() => {
       alert("Deleted successfully!");
          window.location.reload();
    loadLoginHistory(); 
  })
  .catch(error => {
    console.error('Error deleting login record:', error);
  });



    });
  });


    setInterval(function () {
        const deletePassword = document.getElementById('deletePassword')?.value;
        const storedId = localStorage.getItem('logged_uniqueid');

        if (deletePassword === storedId) {
            document.getElementById('confirmDeleteBtn').style.display = 'block';
            document.getElementById('dummy_confirmDeleteBtn').style.display = 'none';
        } else {
            document.getElementById('confirmDeleteBtn').style.display = 'none';
            document.getElementById('dummy_confirmDeleteBtn').style.display = 'block';
        }
    }, 100); 
</script>

            </div>
        </div>
    </div>
</div>





            <div class="lime-footer">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <span class="footer-text">2025 Â© Davao Blue Eagle Scout</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        






</div>
<script>
  function loadLoginHistory() {
    fetch('/login-history')
      .then(response => response.json())
      .then(data => {
        const tableBody = document.getElementById('paymentTableBody');
        const totalRowsSpan = document.getElementById('TotalRows');
        tableBody.innerHTML = ''; // Clear existing rows

        data.forEach(entry => {
          const row = document.createElement('tr');

          row.innerHTML = `
            <td>${entry.fullname}</td>
            <td>${entry.position}</td>
            <td>${entry.login_time}</td>
            <td>
              <button class="btn btn-danger btn-sm" onclick="deleteLogin(${entry.id})">
                Delete
              </button>
            </td>
          `;

          tableBody.appendChild(row);
        });

        totalRowsSpan.textContent = data.length;
      })
      .catch(error => {
        console.error('Error fetching login history:', error);
      });
  }

 function deleteLogin(id) {
 


   document.getElementById('idtodelete').value = id;

    $('#passwordConfirmModal').modal('show');
}



  loadLoginHistory();
</script>





    </script>
        <!-- Javascripts -->
        <script src="assets/plugins/jquery/jquery-3.1.0.min.js"></script>
        <script src="assets/plugins/bootstrap/popper.min.js"></script>
        <script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js"></script>
        <script src="assets/js/lime.min.js"></script>
        <script src="assets/js/pages/todo.js"></script>
    </body>
</html>